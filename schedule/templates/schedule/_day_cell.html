{% load scheduletags %}

{% ifnotequal day.start.month month.start.month %}
  <td class="{{ size }} daynumber noday"></td>
{% else %}
  {% if day.has_occurrences %}
    <td class="{{size}} daynumber busy">
  {% else %}
    <td class="{{size}} daynumber free">
  {% endif %}
  <a href="{% url 'day_calendar' calendar.slug %}{% querystring_for_date day.start 3 %}">
    <div class="header">
      <b>{{day.start.day}}</b>
    </div>
  </a>
  {% ifnotequal size "small" %}
    <div class="daycell">
      {% if day.has_occurrences %}
        {% for o in day.get_occurrence_partials %}
          <div class="eventcell eventcell{{o.class}}{% if o.occurrence.cancelled %} cancelled{% endif %}"
               href="#{% hash_occurrence o.occurrence %}" onclick="openDetail(this);"
               style="{{ o|table_event_width }}{{ o|table_event_margin }}">
            <div class="eventdesc">
              <div class="starttime">
                {% ifequal o.class 0 %}{{ o.occurrence.start|time:"G:i" }}{% endifequal %}
                {% ifequal o.class 1 %}{{ o.occurrence.start|time:"G:i" }}{% endifequal %}
                {% ifequal o.class 2 %}(All day){% endifequal %}
                {% ifequal o.class 3 %}Ends at {{ o.occurrence.end|time:"G:i" }}{% endifequal %}
              </div>
              <div class="title-wrap">
                {% title o.occurrence %}
              </div>
            </div>
          </div>
          <div id="{% hash_occurrence o.occurrence %}" style="display:none;">
            {% detail o.occurrence %}
          </div>
        {% endfor %}
      {% endif %}
    </div>
  {% endifnotequal %}
  </td>
{% endifnotequal %}
